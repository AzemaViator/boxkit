FROM scratch AS ctx
COPY packages /packages/
COPY scripts /scripts/

FROM ghcr.io/ublue-os/fedora-toolbox:latest

LABEL com.github.containers.toolbox="true" \
      usage="This image is meant to be used with the toolbox or distrobox command" \
      summary="An example ContainerFile to demonstrate multiple image builds." \
      authors="azema"

ARG AWSCLI_VERSION="2.27.50"
ARG KUBECTL_VERSION="1.33.2"
ARG TERRAFORM_VERSION="1.12.2"

COPY system-files/devbox /

# Run the setup scripts
RUN --mount=type=cache,dst=/var/cache \
    --mount=type=cache,dst=/var/log \
    --mount=type=bind,from=ctx,source=/,target=/ctx \
    --mount=type=tmpfs,dst=/tmp \
    /ctx/scripts/devbox.sh

VOLUME /var/lib/tool-overlay
